<!DOCTYPE HTML>
<html>
<head>
    <title>Unorganized Thoughts</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/dependencies/setup.css">
    <script src="/dependencies/html-pull.js"></script>
</head>
<body>
    <div w3-include-html="/dependencies/setup.html"></div> 
    <button id="darkModeToggle" title="Toggle dark mode">ðŸŒ™</button>

    <div id="postsContainer"></div>

    <script>
    async function fetchPosts() {
        try {
            const res = await fetch('/api/posts');
            const posts = await res.json();
            const container = document.getElementById('postsContainer');

            posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post';
                const preview = post.content.length > 150 ? post.content.substring(0, 150) + '...' : post.content;

                div.innerHTML = `
                    <h2>${post.title}</h2>
                    <p>${new Date(post.date).toLocaleDateString()}</p>
                    <p style="text-indent: 2em;">${preview}</p>
                    <a href="/post/${new Date(post.date).toISOString().split('T')[0]}">Read more...</a>
                `;
                container.appendChild(div);
            });
        } catch (err) {
            console.error('Failed to fetch posts:', err);
        }
    }

    includeHTML();
    fetchPosts();
    </script>

    <script src="/dependencies/dark-mode.js"></script>
</body>
</html>
